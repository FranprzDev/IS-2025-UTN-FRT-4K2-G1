---
alwaysApply: true
---

# ğŸ¤– Reglas de ImplementaciÃ³n para el Agente AI

Este documento establece las directrices que el Agente AI debe seguir al implementar nuevas features en el proyecto, basandose en BDD.

---

## 1. ğŸ“‹ Flujo de Desarrollo (BDD + TDD)

Siempre seguir el siguiente flujo de desarrollo, priorizando TDD a nivel unitario antes de la implementaciÃ³n completa:

*   **FEATURE (Gherkin):** Leer el comportamiento esperando en el archivo`.feature`.
*   **STEP DEFINITIONS:** Crear la traducciÃ³n de los pasos Gherkin en cÃ³digo.
*   **TDD (Pruebas Unitarias):**
    *   Antes de implementar la lÃ³gica, escribir pruebas unitarias que fallen para:
        *   **Value Objects:** Validaciones en el constructor (ej: `FrecuenciaCardiaca`).
        *   **Modelos:** LÃ³gica interna (ej: `Ingreso.compararCon`).
        *   **Servicios:** LÃ³gica de negocio, utilizando "mocks" para las dependencias (ej: `UrgenciaService`).
    *   Implementar el cÃ³digo mÃ­nimo para que las pruebas unitarias pasen.
    *   Refactorizar el cÃ³digo unitario.
*   **SERVICE:** Implementar la lÃ³gica de negocio principal.
*   **MODELS:** Asegurar que las entidades y sus atributos estÃ©n correctos.
*   **VALUE OBJECTS:** Implementar validaciones complejas.
*   **ValidaciÃ³n Final (BDD):** Ejecutar las pruebas Cucumber para verificar el comportamiento completo de la feature.

---

## 2. ğŸ“ Estructura de Carpetas

Adherirse a la estructura de carpetas definida:

*   `src/`
    *   `models/`: Entidades del dominio.
        *   `valueobjects/`: Validaciones complejas (Value Objects).
    *   `app/`
        *   `interface/`: Contratos (interfaces para inyecciÃ³n de dependencias).
        *   `service/`: LÃ³gica de negocio (Services).
        *   `presentation/`: Controllers/Routes (si aplica).
    *   `test/mocks/`: BD simulada para tests.
*   `test/`
    *   `features/`: Archivos `.feature` (Gherkin).
    *   `step_definitions/`: ImplementaciÃ³n de los pasos Gherkin.
    *   `unit/`: **Nueva carpeta para tests unitarios.**

---

## 3. ğŸ”‘ Reglas Clave de CodificaciÃ³n

*   **Tipos:** Siempre aÃ±adir tipos explÃ­citos a todas las variables, parÃ¡metros y retornos.
*   **Comentarios:** NO aÃ±adir comentarios en el cÃ³digo, salvo que sean excepciones muy justificadas y se discuta previamente. El cÃ³digo debe ser auto-documentado.
*   **Encapsulamiento:** Atributos de modelos deben ser `private`.
*   **Value Objects:** Deben validar sus valores en el constructor y lanzar errores si son invÃ¡lidos.
*   **InyecciÃ³n de Dependecias:** Los servicios deben recibir **interfaces** (contratos) de sus dependencias, no implementaciones concretas.
*   **Early Return:** Siempre que quieras codificar algo, ten en cuenta el patrÃ³n de Early Return.
*   **Lanzamiento de Errores:** Los Value Objects y otras capas de validaciÃ³n deben lanzar errores especÃ­ficos y descriptivos (ej: `InvalidValueError`).
*   **Captura de Errores:** Los servicios o controladores deben capturar y manejar estos errores de manera apropiada, devolviendo respuestas significativas con los cÃ³digos HTTP correctos..

---

## 4. ğŸ“ Convenciones de Nombres

*   **Modelos:** `PascalCase` (ej: `Paciente`, `Ingreso`).
*   **Interfaces:** `PascalCase` (ej: `RepoPacientes`).
*   **Services:** `PascalCase` con sufijo `Service` (ej: `UrgenciaService`).
*   **MÃ©todos Getter:** `get NombrePropiedand()` (ej: `get Cuil(): string`).
*   **MÃ©todos LÃ³gica:** `nombreMetodo()` (ej: `registrarUrgencia()`).
*   **Features:** `kebab-case` (ej: `modulo-urgencias.feature`).
*   **Steps:** `camelCase` dentro del Given/When/Then.

---

## 5. âœ… Checklist Pre-ImplementaciÃ³n (y Post-ImplementaciÃ³n)

Antes de considerar una feature terminada, verificar:

*   [ ] Â¿Se escribiÃ³ la **FEATURE (Gherkin)** primero?
*   [ ] Â¿Se escribieron las **STEP DEFINITIONS**?
*   [ ] Â¿Se aplicÃ³ **TDD** para las **pruebas unitarias** de los componentes clave?
*   [ ] Â¿Todo el cÃ³digo tiene **TIPOS** explÃ­citos?
*   [ ] Â¿No hay **COMENTARIOS** superfluos en el cÃ³digo?
*   [ ] Â¿Los atributos de los **Modelos** son `private`?
*   [ ] Â¿Los **Value Objects** validan en el constructor?
*   [ ] Â¿Los **Services** reciben **INTERFACES** (no implementaciones concretas)?
*   [ ] Â¿Todas las pruebas (unitarias y BDD) pasan (`npm run test:cucumber`, `npm run test:unit`)?
